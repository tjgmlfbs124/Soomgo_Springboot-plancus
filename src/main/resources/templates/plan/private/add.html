<!DOCTYPE html>
<html lang="ko" xmlns:th='http://www.thymeleaf.org' dir="ltr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
    <title>Calendar</title>
    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">
    <link type="text/css" href="/dev/font.css" rel="stylesheet">
    <style>
         .text-label, .modal-title{
         font-family: 'noto_bold';
         }
         .js-lists-values-employee-name, .modal-body{
         font-family: 'noto_demilight';
         color:#303030;
         }
         .mdk-header-layout__content {
         padding-top: 56px;
         }
         .breadcrumb-item::before {
         display: inline-block;
         padding-right: 0.5rem;
         color: rgba(54, 76, 102, 0.24);
         content:none;
         }

    </style>
    <!-- Perfect Scrollbar -->
    <link type="text/css" href="/vendor/perfect-scrollbar.css" rel="stylesheet">
    <!-- App CSS -->
    <link type="text/css" href="/css/app.css" rel="stylesheet">
    <link type="text/css" href="/css/app.rtl.css" rel="stylesheet">
    <!-- Material Design Icons -->
    <link type="text/css" href="/css/vendor-material-icons.css" rel="stylesheet">
    <link type="text/css" href="/css/vendor-material-icons.rtl.css" rel="stylesheet">
    <!-- Font Awesome FREE Icons -->
    <link type="text/css" href="/css/vendor-fontawesome-free.css" rel="stylesheet">
    <link type="text/css" href="/css/vendor-fontawesome-free.rtl.css" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133433427-1"></script>
    <!-- Flatpickr -->
    <link type="text/css" href="/css/vendor-flatpickr.css" rel="stylesheet">
    <link type="text/css" href="/css/vendor-flatpickr.rtl.css" rel="stylesheet">
    <link type="text/css" href="/css/vendor-flatpickr-airbnb.css" rel="stylesheet">
    <link type="text/css" href="/css/vendor-flatpickr-airbnb.rtl.css" rel="stylesheet">
    <script>
         window.dataLayer = window.dataLayer || [];

         function gtag() {
             dataLayer.push(arguments);
         }
         gtag('js', new Date());

         gtag('config', 'UA-133433427-1');

    </script>
    <!-- FullCalendar -->
    <link type="text/css" href="/vendor/fullcalendar/fullcalendar.min.css" rel="stylesheet">
</head>
<body class="layout-default">
<div class="preloader"></div>
<!-- Header Layout -->
<div class="mdk-header-layout js-mdk-header-layout">
    <div th:replace="widget/header"></div>
    <div class="mdk-header-layout__content" id="newPlanDocument">
        <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
            <div class="mdk-drawer-layout__content page">
                <div class="container-fluid page__heading-container">
                    <div class="page__heading d-flex align-items-center" style="margin-bottom:20px;">
                        <div class="flex">
                            <nav aria-label="breadcrumb" style="float:left">
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a href="/"><i class="material-icons"
                                                                               style="font-size:2.2rem;">keyboard_arrow_left</i></a>
                                    </li>
                                    <li style="cursor:pointer; margin-left:10px;">
                                        <button class="btn btn-primary mb-2"
                                                onclick="location.href='/plan/public/request'" style="width:100%;">
                                            <a class="material-icons" style="font-family: 'noto_bold'; font-size:15px;">
                                                AI 일정추가
                                            </a>
                                        </button>
                                    </li>
                                </ol>
                            </nav>
                            <h4 class="m-0" style="float:right; font-family: 'noto_bold';">일정추가</h4>
                        </div>
                    </div>
                </div>
                <div class="container-fluid page__container">
                    <div class="form-group">
                        <div class="input-group input-group-merge"
                             style="font-family: 'noto_demilight'; color:#404040;">
                            <input type="text" required="" class="form-control form-control" placeholder="제목"
                                   name="title" style="margin-right:10px; flex:2 1 0%; background:#fff;">
                            <select class="form-control form-white" data-placeholder="Choose a color..." name="color"
                                    style="background:#ffffff;">
                                <option value="" data-color="#FFFFFF">태그선택</option>
                                <option value="main-business" data-color="#E3AEBC">주업무</option>
                                <option value="sub-business" data-color="#F7BDA6">부업무</option>
                                <option value="friends" data-color="#F8E397">친구, 지인</option>
                                <option value="family" data-color="#C1D588">가족</option>
                                <option value="develop" data-color="#B1CBDB">자기계발</option>
                                <option value="networking" data-color="#D3C1DD">인맥관리</option>
                                <option value="etc" data-color="#DBDBDB">이동,기타</option>
                            </select>
                            <i data-v-da9425c4="" class="material-icons icon-30pt"
                               style="line-height:40px; margin-left:10px; color:#fff;" name="plan-color">lens</i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="text-label">날짜 설정</label>
                        <label class="text-label" style="color:#F5B666; font-size:0.7rem;">(</label>
                        <label class="text-label" style="color:#F5B666; font-size:0.7rem;" name="resultDate"></label>
                        <label class="text-label" style="color:#F5B666; font-size:0.7rem;" name="resultTime"></label>
                        <label class="text-label" style="color:#F5B666; font-size:0.7rem;">)</label>
                        <div class="btn-group btn-group-toggle mb-2" data-toggle="buttons" style="width:100%;"
                             name="periods">
                            <label class="btn btn-light" style="font-family: 'noto_light'; color:#404040;">
                                <input type="radio" data-toggle="modal" data-target="#modal-dateTodate"> 날짜선택
                            </label>
                            <label class="btn btn-light" style="font-family: 'noto_light'; color:#404040;">
                                <input type="radio" data-toggle="modal" data-target="#modal-timeToTime"> 시간선택
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="text-label">장소</label>
                        <div class="search-form form-control-flush search-form--light">
                            <input type="text" class="form-control form-control" placeholder="장소 입력" name="local"
                                   style="background:#fff; border: 1px solid #DBE5EE;"
                                   data-lon="" data-lat="" data-address="">
                            <button class="btn" type="button"
                                    style="border: 1px solid #DBE5EE; height:35px; background:#fff;" name="localSearch">
                                <i class="material-icons">search</i>
                            </button>
                        </div>
                        <table id="localSearchList" class="table mb-0 thead-border-top-0" style="background:#fff; border: 1px solid #DBE5EE; " >
                            <tbody class="list">
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group" style="margin-bottom:6rem;">
                        <label class="text-label">추가 설정</label>
                        <div class="d-flex align-items-center">
                            <div class="btn-group btn-group-toggle mb-3" data-toggle="buttons">
                                <label class="btn btn-light"
                                       style="pointer-events:none; font-family: 'noto_light'; color:#404040;">
                                    <input type="radio" name="option"><i class="material-icons text-muted-light">add</i>
                                </label>
                                <label class="btn btn-light" style="font-family: 'noto_light'; color:#404040;">
                                    <input type="radio" name="option" data-option="todoList"><i
                                        class="material-icons text-muted-light">playlist_add</i> To-do List
                                </label>
                                <label class="btn btn-light" style="font-family: 'noto_light'; color:#404040;">
                                    <input type="radio" name="option" data-option="note"><i
                                        class="material-icons text-muted-light">content_paste</i> 메모
                                </label>
                                <label class="btn btn-light" style="font-family: 'noto_light'; color:#404040;">
                                    <input type="radio" name="option" data-option="link"><i
                                        class="material-icons text-muted-light">insert_link</i> 링크
                                </label>
                            </div>
                        </div>
                        <div class="input-group input-group-merge" id="div-todoList"
                             style="background:#E8F0FE; padding:10px; display:none;">
                            <label class="text-label">To-do List 항목</label>
                            <button class="btn btn-light mb-2 mt-2" onclick="addTodoList(this);" style="width:100%;"
                                    id="btn-add-list">
                                <div data-v-da9425c4="" data-v-70995076="" class="icon">
                                    <i data-v-da9425c4="" class="material-icons" style="color:#404040; font-size:30px;">add</i><span
                                        style="color:#404040;">항목추가</span>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <button class="btn btn-primary mb-2" onclick="onAdd()" style="width:100%; margin-top:50px;">
                            추가하기
                        </button>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="widget/nav"></div>
<div th:replace="plan/modal"></div>
<!-- jQuery -->
<script src="/vendor/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="/vendor/popper.min.js"></script>
<script src="/vendor/bootstrap.min.js"></script>
<!-- Perfect Scrollbar -->
<script src="/vendor/perfect-scrollbar.min.js"></script>
<!-- DOM Factory -->
<script src="/vendor/dom-factory.js"></script>
<!-- MDK -->
<script src="/vendor/material-design-kit.js"></script>
<!-- App -->
<script src="/js/toggle-check-all.js"></script>
<script src="/js/check-selected-row.js"></script>
<script src="/js/dropdown.js"></script>
<!-- <script src="/js/sidebar-mini.js"></script> -->
<script src="/js/app.js"></script>
<script src="/dev/calender.js"></script>
<!-- jQuery UI (for draggable) -->
<script src="/vendor/jquery-ui.min.js"></script>
<!-- Moment.js -->
<script src="/vendor/moment.min.js"></script>
<!-- Flatpickr -->
<script src="/vendor/flatpickr/flatpickr.min.js"></script>
<script src="/js/flatpickr.js"></script>
<script src="/dev/newEvnetListener.js"></script>
<script src="/dev/Calender/planHelper.js"></script>
<script src="/dev/Calender/FilterHelper.js"></script>
<script src="/dev/service.js"></script>
<script src="/dev/restfulApi.js"></script>
<script src="/dev/TMap/getPoi.js"></script>
<script>
         $(document).ready(function() {

             $("label[name=resultDate]").text("선택안함");
             $("label[name=resultTime]").text();
             $("input[name=input-select-period]").val("-");


             for (var i = 1; i < 13; i++) {
               $("select[name=selectTimes-start-hour]").append("<option>" +  i + "</option>");
             }
             for (var i = 0; i < 51; i+=10) {
               $("select[name=selectTimes-start-minute]").append("<option>" +  i + "</option>");
             }
             for (var i = 1; i < 13; i++) {
               $("select[name=selectTimes-end-hour]").append("<option>" +  i + "</option>");
             }
             for (var i = 0; i < 51; i+=10) {
               $("select[name=selectTimes-end-minute]").append("<option>" +  i + "</option>");
             }

         });

         let planHelper = new PlanHelper();
         let devService = new Service();
         let selectStartDate;
         let selectEndDate;

         function onLocalClick(target){
            target = $(target);

            var map = {
                'name' : target.find("p[name=\"local-name\"]").text(),
                'address' : target.find("p[name=\"local-address\"]").text(),
                'lat' : target.find("p[name=\"local-gcs\"]").data("lat"),
                'lon' : target.find("p[name=\"local-gcs\"]").data("lon")
            }

            planHelper.setMap(map);

            $("#localSearchList").hide();
         }


         function addTodoList(target){
            target = $(target);

            target.before("<div class=\"input-group input-group-merge  mt-2\">" +
                "<input type=\"text\" class=\"form-control form-control\" placeholder=\"내용 입력\" name=\"local\" style=\"background:#fff; flex:2 1 0%; min-height:41px;\">" +
                  "<div data-v-da9425c4=\"\" data-v-70995076=\"\" class=\"icon\" onclick=\"removeTodoList(this)\">" +
                     "<i data-v-da9425c4=\"\" class=\"material-icons\" style=\"color:#A6B0BC; font-size:30px; margin-top:5px;\" >close</i>" +
                  "</div>" +
             "</div>");
         }

         function removeTodoList(target){
            target = $(target).parent();

            $("#div-todoList").children()[target.index()].remove();
         }


         function onAdd(){
             const title = $("input[name=title]").val();
             const color = $("select[name=color]").val();
             const local = $("input[name=local]").val();
             if (!title) alert("제목은 필수입니다.");
             else if (!color) alert("태그는 필수입니다.");
             else if (!selectStartDate) alert("일정 날짜와 시간을 선택해주세요");
             else if(new Date(selectStartDate) >= new Date(selectEndDate)) alert("일정 종료시간이 시작시간보다 같거나 작을수 없습니다.")
             else{
                 var todoList = new Array();
                 var listArray  = $("#div-todoList").children().toArray();

                 listArray.forEach((item, i) => {
                    var row = $(item).find("input[type='text']");

                    if(row.length > 0)
                        todoList.push(row.val());

                 });


                 devService.addPlan(title, color, local, selectStartDate, selectEndDate, todoList, function(result){
                    console.log("result : " , result);

                    if (result) {
                     alert("등록되었습니다.");
                     location.href="/plan/monthly";
                    }
                 });
             }



         }

         function date_to_str(format){
             var year = format.getFullYear();
             var month = format.getMonth() + 1;
             var date = format.getDate();

             if(month<10) month = '0' + month;
             if(date<10) date = '0' + date;
             return year + "-" + month + "-" + date;
         }

</script>
</body>
</html>
